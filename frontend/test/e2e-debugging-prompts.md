# 前后端联调测试驱动开发 Prompts

## 概述
本文档总结了通过测试驱动方式进行前后端联调的完整流程和关键prompts，用于指导后续的联调工作。

## 核心方法论

### 1. 测试驱动联调流程
```
编写E2E测试 → 运行测试发现问题 → 分析错误根因 → 修复配置/代码 → 验证修复效果 → 可视化确认
```

### 2. 关键工具组合
- **E2E测试**: Vitest + 原生fetch API
- **可视化验证**: Puppeteer
- **API测试**: curl命令
- **日志分析**: 服务器终端输出

## 实用Prompts集合

### 初始化和环境检查

#### Prompt 1: 检查项目结构和配置
```
请帮我检查前后端项目的基础配置：
1. 查看前端代理配置(vite.config.ts)
2. 检查后端路由配置
3. 确认环境变量设置
4. 验证数据库连接
```

#### Prompt 2: 启动开发环境
```
请帮我启动完整的开发环境：
1. 启动后端服务器(检查端口和数据库连接)
2. 启动前端开发服务器
3. 确认服务间通信正常
```

### E2E测试开发

#### Prompt 3: 创建API测试用例
```
请为[功能名称]创建E2E测试，要求：
1. 测试API端点的基本通信
2. 验证请求响应格式
3. 检查状态码和错误处理
4. 包含正向和负向测试场景
```

#### Prompt 4: 问题诊断流程
```
当E2E测试失败时，请按以下顺序排查：
1. 检查API响应状态码和错误信息
2. 查看前端代理配置是否正确
3. 确认后端路由和控制器实现
4. 验证数据库连接和数据状态
5. 检查环境变量和配置文件
```

### 可视化验证

#### Prompt 5: Puppeteer界面测试
```
请使用Puppeteer进行界面功能验证：
1. 导航到目标页面
2. 填写表单数据
3. 触发用户交互
4. 截图记录状态
5. 验证页面跳转和数据存储
```

#### Prompt 6: 状态管理验证
```
请验证前端状态管理：
1. 检查localStorage/sessionStorage中的数据
2. 验证Context状态更新
3. 确认组件重新渲染
4. 测试路由守卫和权限控制
```

### 常见问题解决

#### Prompt 7: 代理配置问题
```
当出现426/404等状态码时：
1. 检查vite.config.ts中的proxy配置
2. 确认后端服务器运行端口
3. 验证API路径是否正确
4. 重启前端服务器应用配置
```

#### Prompt 8: 认证问题排查
```
当出现401/403认证错误时：
1. 检查JWT token生成和验证逻辑
2. 确认环境变量JWT_SECRET设置
3. 验证用户数据和密码加密
4. 测试token存储和传递机制
```

#### Prompt 9: 数据库连接问题
```
当出现数据库相关错误时：
1. 检查MongoDB连接字符串
2. 验证数据库服务状态
3. 确认数据模型定义
4. 检查索引和约束设置
```

## 最佳实践

### 1. 测试数据管理
- 为每个测试场景创建独立的测试用户
- 使用唯一标识符避免数据冲突
- 测试后清理或使用隔离的测试数据库

### 2. 错误处理策略
- 优先检查网络层问题(代理、端口)
- 然后排查应用层逻辑(路由、控制器)
- 最后验证数据层问题(数据库、模型)

### 3. 调试技巧
- 使用curl命令快速验证API
- 查看服务器日志获取详细错误信息
- 结合浏览器开发者工具分析网络请求
- 使用Puppeteer截图记录测试状态

### 4. 文档记录
- 记录每次修复的具体步骤
- 保存有效的测试用例和数据
- 维护常见问题的解决方案库

## 示例命令

### 运行测试
```bash
# 运行特定E2E测试
npx vitest run test/e2e/login.e2e.test.ts

# 运行所有E2E测试
npm run test:e2e
```

### API测试
```bash
# 测试注册API
curl -X POST http://localhost:5001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","email":"test@example.com","password":"password123"}'

# 测试登录API
curl -X POST http://localhost:5001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

### 服务启动
```bash
# 启动后端
cd backend && npm run dev

# 启动前端
cd frontend && npm run dev
```

## 总结

通过测试驱动的方式进行前后端联调，能够：
1. 快速发现和定位问题
2. 确保功能的完整性和正确性
3. 提供可重复的验证流程
4. 建立可靠的回归测试基础

这套prompts和方法论可以应用于任何前后端功能的联调工作，通过系统化的测试和验证流程，确保开发质量和效率。